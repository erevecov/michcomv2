{{!< layout/default}}

{{#extend "css"}} 
<style>

</style>

{{/extend}}

<!--Html principal-->
<nav>
    <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#insertRepairs" role="tab" aria-controls="nav-home" aria-selected="true">Reparaciones</a>
        <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#maintainerClient" role="tab" aria-controls="nav-profile" aria-selected="false">Clientes</a>
        <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#maintainerEquipmentSat" role="tab" aria-controls="nav-contact" aria-selected="false">Equipos</a>
    </div>
</nav>



<!-- REPARACIONES-->
<div class="tab-content">
    <div class="tab-pane fade show active" id="insertRepairs" role="tabpanel" aria-labelledby="enables-tab">
        <div class="row">
            <div class="col-md-2 col-xs-12">
                <br>
                <button class="btn btn-primary btn-block" id="newRepair">
                    <i class="fa fa-plus" aria-hidden="true"></i> Agregar
                </button>
                <br>
                <button class="btn btn-warning btn-block" id="modButton" disabled>
                    <i class="fa fa-pencil-square-o" aria-hidden="true"></i> Modificar
                </button>
                <br>
                <button class="btn btn-danger btn-block" id="desButton" disabled>
                    <i class="fa fa-times" aria-hidden="true"></i> Deshabilitar
                </button>
                <br>
                <button class="btn btn-primary btn-block" id="estButton" disabled>
                    <i class="fa fa-check-square-o" aria-hidden="true"></i> Estado
                </button>
                <br>
            </div>

            <div class="col-md-10 col-xs-12 box-shadows table-responsive">
                <table id="table" class="display nowrap table table-condensed" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Equipo</th>
                            <th>Fecha</th>
                            <th>Razón de ingreso</th>
                            <th>Técnico</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                </table>
                <div id="loadingRepairs">
                    <center>
                        <i style="color:#3498db;" class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
                        <span class="sr-only">Loading...</span>
                    </center>
                </div>
            </div>
        </div>
    </div>

<!-- CLIENTES-->

    <div class="tab-pane fade" id="maintainerClient" role="tabpanel" aria-labelledby="disabled-tab">
        <div class="row">
            <div class="col-md-2 col-xs-12 box-shadows">
                <br>
                    <button class="btn btn-primary btn-block" id="newClientMaintainer">
                        <i class="fa fa-plus" aria-hidden="true"></i> Agregar
                    </button>
                    <br>
                    <button class="btn btn-warning btn-block" id="modClientMaintainer" disabled>
                        <i class="fa fa-pencil-square-o" aria-hidden="true"></i> Modificar
                    </button>
                    <br>
                    <button class="btn btn-danger btn-block" id="desClientMaintainer" disabled>
                        <i class="fa fa-times" aria-hidden="true"></i> Deshabilitar
                    </button>
                <br>
            </div>

            <div class="col-md-10 col-xs-12 box-shadows table-responsive">
                <table id="tableClient"  class="display nowrap table table-condensed" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Celular</th>
                            <th>Correo</th>
                            <th>Dirección</th>
                        </tr>
                    </thead>
                </table>
                <div id="loadingClients">
                    <center>
                        <i style="color:#3498db;" class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
                        <span class="sr-only">Loading...</span>
                    </center>
                </div>
            </div>
        </div>
    </div>

<!-- EQUIPOS-->
    <div class="tab-pane fade" id="maintainerEquipmentSat" role="tabpanel" aria-labelledby="disabled-tab">
    <div class="row">
        <div class="col-md-2 col-xs-12 box-shadows">
            <br>
            <button class="btn btn-primary btn-block" id="newEquipmentMaintainer">
                <i class="fa fa-plus" aria-hidden="true"></i> Agregar
            </button>
            <br>
            <button class="btn btn-warning btn-block" id="modEquipmentMaintainer" disabled>
                <i class="fa fa-pencil-square-o" aria-hidden="true"></i> Modificar
            </button>
            <br>
            <button class="btn btn-danger btn-block" id="desEquipmentMaintainer" disabled>
                <i class="fa fa-times" aria-hidden="true"></i> Deshabilitar
            </button>
            <br>
        </div>

        <div class="col-md-10 col-xs-12 box-shadows table-responsive">
            <table id="tableClient" class="display nowrap table table-condensed" cellspacing="0" width="100%">
                <thead>
                    <tr>
                        <th>Nombre</th>

                    </tr>
                </thead>
            </table>
            <div id="loadingClients">
                <center>
                    <i style="color:#3498db;" class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
                    <span class="sr-only">Loading...</span>
                </center>
            </div>
        </div>
    </div>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="satModal" tabindex="-1" role="dialog" aria-labelledby="modal_title">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="modal_title"></h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>

            </div>
            <div class="modal-body" id="modal_body"></div>
            <div class="modal-footer" id="modal_footer"></div>
        </div>
    </div>
</div>




{{#extend "js"}}
<script src="public/js/datetime-moment.js"></script>
<script>
    let clientsData; // todos los datos de todos los clientes
    let satEquipment; // todos los datos de equipos, marcs, modelos
    let selects = { // arreglos para select2
        technicals: [],
        clients: [],
        equipmentTypes: [],
        brands: [],
        models: []
    }
    let repairRowSelectedData;
    let datatable;
    let datatableClient;
    let selectedClientPhone;

    jQuery(document).ready(function ($) {
        chargeTable();
        chargeTableClient();
        
        /*
        ajax({
            url: 'api/clients'
        }).then(res=>{
            console.log(res)
        })
        */


        NProgress.done(); /* TODO CARGADO! */
    });
//DATATABLE INICIO reparacion
function chargeTable() {
    $.fn.dataTable.moment( 'DD/MM/YYYY hh:mm' );
    datatable = $('#table')
    .DataTable({
        "order": [[ 2, "desc" ]],
        "iDisplayLength": 100,
        "oLanguage": {
            "sSearch": ""
        },
        "responsive": true,
        "columns": [
            { "data": "client" },       
            { "data": "equipment" },
            { "data": "date" },
            { "data": "fail" },
            { "data": "technical" },
            { "data": "status" },
           

        ],
        initComplete: function (settings, json) {
            ajax({
                url:'api/satRepairs'
            }).then(res => {
                if (res.err){
                    toastr.warning('No existen reparaciones')
                }else{                               
                    datatable.rows.add(res).draw();
                   
                    $('#loadingRepairs').empty();
                }
            })
        }
    });



    $('#table tbody').on('click', 'tr', function () {
        if ($(this).hasClass('selected')) {
            $(this).removeClass('selected');
            $('#modButton').prop('disabled', true);
            $('#desButton').prop('disabled', true);
            $('#estButton').prop('disabled', true);
        } else {
            datatable.$('tr.selected').removeClass('selected');
            $(this).addClass('selected');
            repairRowSelectedData = datatable.row($(this)).data();
            console.log(repairRowSelectedData)
            $('#modButton').prop('disabled', false);
            $('#desButton').prop('disabled', false);
            $('#estButton').prop('disabled', false);
        }
    });
}
//DATATABLE FINAL recargar

    function reloadRepairTable() {
        ajax({
            url:'api/satRepairs'
        }).then(res => {
            if (res.err){
                toastr.warning('No existen reparaciones')
            }else{       
                datatable.clear().draw();                        
                datatable.rows.add(res).draw();
            }
        })
        
    }
//xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
//DATATABLE Clientes mantenedor
    function chargeTableClient() {
        datatableClient = $('#tableClient')
        .DataTable({
                    "iDisplayLength": 100,
                    "oLanguage": {
                        "sSearch": ""
                    },
                    "responsive": true,
                    "columns": [
                        { "data": "name" },
                        { "data": "phone" },
                        { "data": "email" },
                        { "data": "address" },
                    ],
                initComplete: function (settings, json) {
                    ajax({
                        url: 'api/satClient'
                    }).then(res => {
                        if (res.err) {
                            toastr.warning('No existen Clientes')
                        } else {
                            datatableClient.rows.add(res).draw();
                            $('#loadingClients').empty();
                        }      
                    })
            }
        });
     $('#tableClient tbody').on('click', 'tr', function () {
            if ($(this).hasClass('selected')) {
                $(this).removeClass('selected');
                $('#modClientMaintainer').prop('disabled', true);
                $('#desClientMaintainer').prop('disabled', true);
              
            } else {
                datatableClient.$('tr.selected').removeClass('selected');
                $(this).addClass('selected');
                ClientRowSelectedData = datatableClient.row($(this)).data();
                console.log(ClientRowSelectedData)
                $('#modClientMaintainer').prop('disabled', false);
                $('#desClientMaintainer').prop('disabled', false);
               
               
            }
        });
}
//DATATABLE FINAL recargar
    function reloadRepairTableClient() {
        ajax({
            url: 'api/satClient'
        }).then(res => {
            if (res.err) {
                toastr.warning('No existen Clientes')
            } else {
                datatableClient.clear().draw();
                datatableClient.rows.add(res).draw();
            }
        })

    }

//BOTON DESHABILITAR reparacion
$('#desButton').on('click', function() {
    swal({
        title: '¿Estás seguro?',
        text: 'Podrás revertir esta acción desde la pestaña "Reparaciones deshabilitadas"',
        type: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Si, deshabilitar!',
        cancelButtonText: 'No, cancelar!',
        confirmButtonClass: 'btn btn-primary',
        cancelButtonClass: 'btn btn-default',
        buttonsStyling: false,
        animation: false,
        customClass: 'animated tada'
    })
});
//xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
//BOTON ESTADO
    $('#estButton').on('click', function () {
    $('#satModal').modal();
    $('#modal_title').text('CAMBIAR ESTADO REPARACIÓN');
    $('#modal_body').html(`
    

    `)
    });
//xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

// //BOTON DE MODIFICAR ACTIVADO clientes
  $('#modClientMaintainer').on('click', function () {
      newModClient();
    })

     function newModClient() { 
        $('#satModal').modal();
        $('#modal_title').text('MODIFICAR CLIENTES');
        $('#modal_body').html(`
             <div style="padding:5px;"> 
                    <div class="row">
                        <div class="col-md-12" style="margin-top:20px;">
                            <label style="float:left;"><i class="fa fa-user" aria-hidden="true"></i> Nombre</label>
                            <input value="${ClientRowSelectedData.name}" id="clientNameFormMod" type="text"  required class="form-control border-input" placeholder="Nombre del cliente">
                        </div>

                        <div class="col-md-12" style="margin-top:20px;">
                            <label style="float:left;"><i class="fa fa-phone-square" aria-hidden="true"></i> Celular</label>
                            <input value="${ClientRowSelectedData.phone}" id="clientPhoneFormMod" type="text" class="form-control border-input"  value="" placeholder="Ingrese celular">
                        </div>

                        <div class="col-md-12" style="margin-top:20px;">
                            <label style="float:left;"><i class="fa fa-envelope" aria-hidden="true"></i> Correo</label>
                            <input value="${ClientRowSelectedData.email}" id="clientEmailFormMod" type="email" name="email" class="form-control border-input"  value="" placeholder="Ingrese correo">
                        </div>

                        <div class="col-md-12" style="margin-top:20px;">
                            <label style="float:left;"><i class="fa fa-home" aria-hidden="true"></i> Dirección</label>
                            <input value="${ClientRowSelectedData.address}" id="clientAddressFormMod" type="text" class="form-control border-input"  value="" placeholder="Ingrese dirección">
                        </div>
                        <div class="col-md-12" style="margin-top:20px;">
                            <button id="sendModClientSat" class="btn btn-primary btn-block" > MODIFICAR CLIENTE  <i class="fa fa-paper-plane" aria-hidden="true"></i></button>
                        </div>
                    </div>
                </div>    
        `)

        $('#sendModClientSat').on('click', function () {
            let c_name = $('#clientNameFormMod').val();
            let c_phone = $('#clientPhoneFormMod').val();
            let c_email = $('#clientEmailFormMod').val();
            let c_address = $('#clientAddressFormMod').val();

            ajax({
                url: 'api/modSatClient',
                type: 'POST',
                data: {
                    id: ClientRowSelectedData._id,
                    name: c_name,
                    address: c_address,
                    phone: c_phone,
                    email: c_email
                }
            }).then(res => {
                if (res.error) {
                    toastr.error(res.error)
                } else {
                    swal({
                        title: 'Cliente Modificado correctamente!',
                        text: res.ok,
                        backdrop: 'static',
                        keyboard: false,
                        type: 'success',
                        timer: 3000
                    }).then(result => {
                        $('#satModal').modal('hide')
                        reloadRepairTableClient()
                    })
                }
            })


        });
};

//
//BOTON DE MODIFICAR ACTIVADO reparacion
    $('#modButton').on('click', function () {
    $('#satModal').modal();
    $('#modal_title').text('MODIFICAR REPARACIÓN');
    $('#modal_body').html(`
        <div style="padding:5px;"> 
        <div class="row">
            <div class="col-md-12">
                <label style="float:left;"><i class="fa fa-user-circle" aria-hidden="true"></i> Técnico</label>
                <input value="${repairRowSelectedData.technical}" id="technicalNameFormMod" type="text"  required class="form-control border-input">
            </div>

            <div class="col-md-12" style="margin-top:20px;">
                <label style="float:left;"><i class="fa fa-user" aria-hidden="true"></i> Cliente</label>
                <input value="${repairRowSelectedData.client}" id="clientNameFormMod" type="text"  required class="form-control border-input">
            </div>
           
            <div class="col-md-12" style="margin-top:20px;">
                <label style="float:left;"><i class="fa fa-laptop" aria-hidden="true"></i> Tipo de equipo</label>
                <input value="${repairRowSelectedData.equipment1}" id="equipmentNameFormMod" type="text"  required class="form-control border-input">
            </div>

            <div class="col-md-6"  style="margin-top:20px;">
                <label><i class="fa fa-bookmark" aria-hidden="true"></i> Marca</label>    
            </div>
            <div class="col-md-6"  style="margin-top:20px;">
                <label><i class="fa fa-bookmark" aria-hidden="true"></i> Modelo</label>    
            </div>

            <div class="col-md-12" >
                <div class="row"> 
                    <div class="col-md-6" style="margin-top:5px;">
                        <input value="${repairRowSelectedData.brand} "id="brandNameFormMod" type="text"  required class="form-control border-input">
                    </div>
                   
                        <div class="col-md-6" style="margin-top:5px;">
                         <input value="${repairRowSelectedData.model}" id="modelNameFormMod" type="text"  required class="form-control border-input">
                    </div>
                </div>
            </div>

            <div class="col-md-12" style="margin-top:20px;">
                <label><i class="fa fa-list-ol" aria-hidden="true"></i> Accesorios</label>
                <textarea id="accessoryNameFormMod" rows="2" class="form-control border-input">${repairRowSelectedData.accesory}</textarea>
            </div>

            <div class="col-md-12" style="margin-top:20px;">
                <label><i class="fa fa-times" aria-hidden="true"></i> Razón de ingreso</label>
                <textarea id="failNameFormMod" rows="2" class="form-control border-input" placeholder="Ingrese la razón de ingreso">${repairRowSelectedData.fail}</textarea>
            </div>

            <div class="col-md-12" style="margin-top:20px;">
                <button id="sendModRepairSat" class="btn btn-primary btn-block" > MODIFICAR  <i class="fa fa-paper-plane" aria-hidden="true"></i></button>
            </div>

        </div>  
        </div>   
    `)
    
    $('#sendModRepairSat').on('click', function () {
            let c_technicalName = $('#technicalNameFormMod').val();
            let c_clientName = $('#clientNameFormMod').val();
            let c_equipmentName = $('#equipmentNameFormMod').val();
            let c_brandName = $('#brandNameFormMod').val();
            let c_modelName = $('#modelNameFormMod').val();
            let c_accessoryName = $('#accessoryNameFormMod').val();
            let c_failName = $('#failNameFormMod').val();

            ajax({
                url: 'api/modSatRepair',
                type: 'POST',
                data: {
                    id_var: repairRowSelectedData._id,
                    technicalName: c_technicalName,
                    clientName: c_clientName,
                    equipmentName: c_equipmentName,
                    brandName: c_brandName,
                    modelName: c_modelName,
                    accesoryName: c_accessoryName,
                    failName: c_failName
                }
            }).then(res => {
                if (res.error) {
                    toastr.error(res.error)
                } else {
                    swal({
                        title: 'Reparación modificada correctamente!',
                        text: res.ok,
                        backdrop: 'static',
                        keyboard: false,
                        type: 'success',
                        timer: 3000
                    }).then(result => {
                        $('#satModal').modal('hide')
                        reloadRepairTable()
                    })
                }
            })


        });

    });
//

    $('#satModal').on('shown.bs.modal', function () { // IMPORTANTE FOCUS MODAL SWAL
        $(document).off('focusin.modal');
    });

    $('#newRepair').on('click', function(){
       newRepair();     
    });
    /* Agregar cliente */
    $('#newClientMaintainer').on('click', function () {
        newClient();
    });
    $('#createClientFormButton').on('click', function () {
        newClient();
    });


    /* Modal agregar cliente */
    function newClient() {
        swal({
            title: '',
            html:`
                <div style="padding:5px;"> 
                    <h4>INGRESE UN NUEVO CLIENTE</h4>
                    <div class="row">
                        <div class="col-md-12" style="margin-top:20px;">
                            <label style="float:left;"><i class="fa fa-user" aria-hidden="true"></i> Nombre</label>
                            <input id="clientNameForm" type="text"  required class="form-control border-input" placeholder="Nombre del cliente">
                        </div>

                        <div class="col-md-12" style="margin-top:20px;">
                            <label style="float:left;"><i class="fa fa-phone-square" aria-hidden="true"></i> Celular</label>
                            <input id="clientPhoneForm" type="text" class="form-control border-input"  value="" placeholder="Ingrese celular">
                        </div>

                        <div class="col-md-12" style="margin-top:20px;">
                            <label style="float:left;"><i class="fa fa-envelope" aria-hidden="true"></i> Correo</label>
                            <input id="clientEmailForm" type="email" name="email" class="form-control border-input"  value="" placeholder="Ingrese correo">
                        </div>

                        <div class="col-md-12" style="margin-top:20px;">
                            <label style="float:left;"><i class="fa fa-home" aria-hidden="true"></i> Dirección</label>
                            <input id="clientDirectionForm" type="text" class="form-control border-input"  value="" placeholder="Ingrese dirección">
                        </div>

                        <div class="col-md-3" style="margin-top:20px;">
                            <button id="cleanNewClientForm" class="btn btn-dark btn-block" >LIMPIAR</button>
                        </div>

                        <div class="col-md-9" style="margin-top:20px;">
                            <button id="createNewClientForm" class="btn btn-primary btn-block" > AGREGAR NUEVO CLIENTE  <i class="fa fa-paper-plane" aria-hidden="true"></i></button>
                        </div>
                    </div>
                </div>    
            `,
            showCloseButton: true,
            showCancelButton: false,
            showConfirmButton: false,
            animation: false,
            customClass: 'animated fadeIn'
        })

        $('#cleanNewClientForm').on('click', function () {
            $('#clientNameForm').val('')
            $('#clientDirectionForm').val('')
            $('#clientPhoneForm').val('')
            $('#clientEmailForm').val('')
            $('#clientNameForm').focus()
        })
        $('#createNewClientForm').on('click', function(){
            let newClientFormName = $('#clientNameForm').val() 
            let newClientFormDirection = $('#clientDirectionForm').val()
            let newClientFormPhone = $('#clientPhoneForm').val()
            let newClientFormEmail = $('#clientEmailForm').val()

            ajax({
                url: 'api/newClientSat', 
                type: 'POST',
                data: {
                    name: newClientFormName,
                    address: newClientFormDirection,
                    phone: newClientFormPhone,
                    email: newClientFormEmail
                }
            }).then(res=>{
                if (res.err){
                    toastr.error(res.err)
                }else{
                    swal({
                        title: 'Agregado!',
                        text: res.ok,
                        backdrop: 'static', 
                        keyboard: false,
                        type: 'success',
                        timer: 3000
                    }).then(result=>{
                        $('#satModal').modal('hide')
                         reloadRepairTableClient()
                    })

                   
                }
            })

        })
}
    /* Modal agregar Tipo de equipo */
    $('#modal_body').on('click', '#createEquipmentFormButton', function () {
        swal({
            title: '',
            html:`
                <div style="padding:5px;"> 
                    <h4>INGRESE UN NUEVO TIPO DE EQUIPO</h4>
                    <div class="row">
                        <div class="col-md-12" style="margin-top:20px;">
                            <label style="float:left;"><i class="fa fa-laptop" aria-hidden="true"></i> Tipo</label>
                            <input id="equipmentForm" type="text" class="form-control border-input"  required placeholder="Ingrese tipo de equipo">
                        </div>

                        <div class="col-md-3" style="margin-top:20px;">
                            <button id="cleanNewEquipmentForm" class="btn btn-dark btn-block" >LIMPIAR</button>
                        </div>

                        <div class="col-md-9" style="margin-top:20px;">
                            <button id="createNewEquipmentForm" class="btn btn-primary btn-block" > AGREGAR NUEVO EQUIPO  <i class="fa fa-paper-plane" aria-hidden="true"></i></button>
                        </div>
                    </div>
                </div>    
            `,
            showCloseButton: true,
            showCancelButton: false,
            showConfirmButton: false,
            animation: false,
            customClass: 'animated fadeIn'
        })
        $('#cleanNewEquipmentForm').on('click', function () {
            $('#equipmentForm').val('')
            $('#equipmentForm').focus()
        })

        $('#createNewEquipmentForm').on('click', function () {
            let newEquipmentFormName = $('#equipmentForm').val()
            ajax({
                url: 'api/newEquipmentSat',
                type: 'POST',
                data: {
                    name: newEquipmentFormName
                }
            }).then(res => {
                console.log(res)
               	swal({
                    title: 'Agregado!',
                    backdrop: 'static', 
                    keyboard: false,
                    text: res.ok,
                    type: 'success',
                    timer: 60000
                })
            })

        })
    })

    /* Modal agregar Marca */
    $('#modal_body').on('click', '#createBrandFormButton', function () {
        swal({
            title: '',
            html:`
                <div style="padding:5px;"> 
                    <h4>INGRESE UNA NUEVA MARCA</h4>
                    <div class="row">
                        <div class="col-md-12" style="margin-top:20px;">
                            <label style="float:left;"><i class="fa fa-bookmark" aria-hidden="true"></i> Marca</label>
                            <input id="brandForm" type="text" class="form-control border-input" required placeholder="Ingrese nueva marca">
                        </div>

                        <div class="col-md-3" style="margin-top:20px;">
                            <button id="cleanNewBrandForm" class="btn btn-dark btn-block" >LIMPIAR</button>
                        </div>

                        <div class="col-md-9" style="margin-top:20px;">
                            <button id="" class="btn btn-primary btn-block" > AGREGAR NUEVA MARCA  <i class="fa fa-paper-plane" aria-hidden="true"></i></button>
                        </div>
                    </div>
                </div>    
            `,
            showCloseButton: true,
            showCancelButton: false,
            showConfirmButton: false,
            animation: false,
            customClass: 'animated fadeIn'
        })
        $('#cleanNewBrandForm').on('click', function () {
            $('#brandForm').val('')
            $('#brandForm').focus()
        })
        
    })
    
    /* Modal agregar Modelo */
    $('#modal_body').on('click', '#createModelFormButton', function () {
        swal({
            title: '',
            html:`
                <div style="padding:5px;"> 
                    <h4>INGRESE UN NUEVO MODELO</h4>
                    <div class="row">
                        <div class="col-md-12" style="margin-top:20px;">
                            <label style="float:left;"><i class="fa fa-bookmark" aria-hidden="true"></i> Modelo</label>
                            <input id="modelForm" type="text" class="form-control border-input" required placeholder="Ingrese nuevo modelo">
                        </div>

                        <div class="col-md-3" style="margin-top:20px;">
                            <button id="cleanNewModelForm" class="btn btn-dark btn-block" >LIMPIAR</button>
                        </div>
                        <div class="col-md-9" style="margin-top:20px;">
                            <button id="" class="btn btn-primary btn-block" > AGREGAR NUEVO MODELO  <i class="fa fa-paper-plane" aria-hidden="true"></i></button>
                        </div>
                    </div>
                </div>    
            `,
            showCloseButton: true,
            showCancelButton: false,
            showConfirmButton: false,
            animation: false,
            customClass: 'animated fadeIn'
        })
        $('#cleanNewModelForm').on('click', function () {
            $('#modelForm').val('')
            $('#modelForm').focus()
        })
    })

   
    function newRepair() {
        $('#satModal').modal();
        $('#modal_title').text('INGRESAR NUEVO EQUIPO');
        $('#modal_body').html(`
            <div style="padding:5px;"> 
                <div class="row">

                     <div class="col-md-12">
                        <label for="tecnicoseleccion"><i class="fa fa-user-circle" aria-hidden="true"></i> Técnico</label>
                        <div class="row"> 
                            <div class="col-md-12" style="margin-top:5px;">
                                <select id="selectTechnical">
                                    <option></option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12"  style="margin-top:20px;">
                        <label for="tecnicoseleccion"><i class="fa fa-user" aria-hidden="true"></i> Cliente</label>
                        <div class="row"> 
                            <div class="col-md-8" style="margin-top:5px;">
                                <select id="selectClient" name="state">
                                    <option></option>
                                </select>
                            </div>
                            <div class="col-md-1" style="margin-top:5px;">
                                <i class="fa fa-commenting-o" aria-hidden="true"></i>
                            </div>
                            <div class="col-md-1" style="margin-top:5px;">
                                <i class="fa fa-envelope-o" aria-hidden="true"></i>
                            </div>
                            <div class="col-md-2">
                                <button id="createClientFormButton" onclick="newClient();"  class="btn btn-dark btn-block"><i class="fa fa-plus" aria-hidden="true"></i></button>
                            </div> 
                        </div>
                    </div>

                    <div class="col-md-12"  style="margin-top:20px;">
                        <label for="tecnicoseleccion"><i class="fa fa-laptop" aria-hidden="true"></i> Tipo de equipo</label>
                        <div class="row"> 
                            <div class="col-md-10" style="margin-top:5px;">
                                <select id="selectEquipment" name="state">
                                    <option></option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <button id="createEquipmentFormButton" class="btn btn-dark btn-block"><i class="fa fa-plus" aria-hidden="true"></i></button>
                            </div> 
                        </div>
                    </div>

                    <div class="col-md-6"  style="margin-top:20px;">
                        <label><i class="fa fa-bookmark" aria-hidden="true"></i> Marca</label>    
                    </div>
                    <div class="col-md-6"  style="margin-top:20px;">
                        <label><i class="fa fa-bookmark" aria-hidden="true"></i> Modelo</label>    
                    </div>

                    <div class="col-md-12" >
                        <div class="row"> 
                            <div class="col-md-4" style="margin-top:5px;">
                                <select id="selectBrand">
                                    <option></option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <button id="createBrandFormButton" class="btn btn-dark btn-block" disabled><i class="fa fa-plus" aria-hidden="true"></i></button>
                            </div> 
                             <div class="col-md-4" style="margin-top:5px;">
                                <select id="selectModel">
                                    <option></option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <button id="createModelFormButton" class="btn btn-dark btn-block" disabled><i class="fa fa-plus" aria-hidden="true"></i></button>
                            </div> 
                        </div>
                    </div>

                    <div class="col-md-12" style="margin-top:20px;">
                        <label><i class="fa fa-list-ol" aria-hidden="true"></i> Accesorios</label>
                        <textarea id="repairAccessoryForm" rows="2" class="form-control border-input" placeholder="Ingrese los accesorios"></textarea>
                    </div>

                    <div class="col-md-12" style="margin-top:20px;">
                        <label><i class="fa fa-times" aria-hidden="true"></i> Razón de ingreso</label>
                        <textarea id="repairFailForm" rows="2" class="form-control border-input" placeholder="Ingrese la razón de ingreso"></textarea>
                    </div>

                    <div class="col-md-3" style="margin-top:20px;">
                    	<button id="cleanNewRepairForm" class="btn btn-dark btn-block" >LIMPIAR</button>
                    </div>
                     <div class="col-md-9" style="margin-top:20px;">
                    	<button id="createNewRepairForm" class="btn btn-primary btn-block" > AGREGAR NUEVO EQUIPO  <i class="fa fa-paper-plane" aria-hidden="true"></i></button>
                    </div>

                </div>   
            </div>
            `)
//AGREGAR REPARACION
        $('#createNewRepairForm').on('click', function () {
            let newRepairtFormTechnical = $('#selectTechnical').select2('data')[0].text;
            let newRepairFormClient = $('#selectClient').select2('data')[0].text;
            let newRepairFormEquipment = $('#selectEquipment').select2('data')[0].text;
            let newRepairFormBrand = $('#selectBrand').select2('data')[0].text;
            let newRepairFormModel = $('#selectModel').select2('data')[0].text;
            let newRepairFormAccessory = $('#repairAccessoryForm').val();
            let newRepairFormFail = $('#repairFailForm').val();


            ajax({
                url: 'api/newRepairSat',
                type: 'POST',
                data: {
                    technical: newRepairtFormTechnical,
                    client: newRepairFormClient,
                    equipment: newRepairFormEquipment,
                    brand: newRepairFormBrand,
                    model: newRepairFormModel,
                    accesory: newRepairFormAccessory,
                    fail: newRepairFormFail
                }
            }).then(res => {
                swal({
                    title: 'Agregado!',
                    text: res.ok,
                    backdrop: 'static',
                    keyboard: false,
                    type: 'success',
                    timer: 3000
                });
                
                reloadRepairTable();
            })
        })
        //FALTA LIMPIAR
        $('#cleanNewRepairForm').on('click', function () {
            newRepair()
        })
        /*
            CARGAR LOS SELECT2 INICIO
        */

        ajax({ // cargar técnicos
            url: 'api/users'
        }).then(res => {
            selects.technicals = res.reduce((arr, el, i) => {
                return arr.concat({
                    id: i,
                    text: el.name + ' ' + el.lastname
                })
            }, [])

            $('#selectTechnical').select2({
                placeholder: "Seleccione técnico",
                width: '100%',
                data: selects.technicals
            });
        })

        ajax({
            url: 'api/satClients'
        }).then(res => {
            clientsData = res;
            selects.clients = res.reduce((arr, el, i) => {
                return arr.concat({
                    id: i,
                    text: el.name
                })
            }, [])


            $('#selectClient').select2({
                placeholder: "Seleccione cliente",
                width: '100%',
                data: selects.clients
            });
        })

        ajax({
            url: 'api/satEquipment'
        }).then(res => {
            console.log(res)
            satEquipment = res.types
            selects.equipmentTypes = satEquipment.reduce((arr, el, i) => {
                return arr.concat(el.type)
            }, []);

            $('#selectEquipment').select2({
                placeholder: "Seleccione equipo",
                width: '100%',
                data: selects.equipmentTypes
            });


            $('#selectBrand').select2({
                placeholder: "Seleccione marca",
                allowClear: true,
                width: '100%',
                disabled: true
            });


            $('#selectModel').select2({
                placeholder: "Seleccione modelo",
                allowClear: true,
                width: '100%',
                disabled: true
            });
            
            $('#selectClient').on('change', function (e) {
                let selectedClient = $('#selectClient').select2('data')[0].text;
                console.log(clientsData)
                
            });

            $('#selectEquipment').on('change', function (e) {
                $('#selectBrand').prop('disabled', false);
                $('#createBrandFormButton').prop('disabled', false);
                let equipmentSelected = $('#selectEquipment').select2('data')[0].text;
                console.log(equipmentSelected)

                let brandSelected = satEquipment.filter(function (el) {
                    return el.type == equipmentSelected
                })
                selects.brands = brandSelected[0].brands.reduce((arr, el, i) => {
                    return arr.concat({
                        id: i,
                        text: el.brand
                    })
                }, [])

                console.log(selects.brands)
                $('#selectBrand').empty()
                $('#selectBrand').select2({
                    placeholder: "Seleccione marca",
                    width: '100%',
                    data: selects.brands
                }).change();

            });

            $('#selectBrand').on('change', function (e) {
                $('#selectModel').prop('disabled', false);
                $('#createModelFormButton').prop('disabled', false);
                let equipmentSelected = $('#selectEquipment').select2('data')[0].text;
                let textBrandSelected = $('#selectBrand').select2('data')[0].text;

                let typeSelected = satEquipment.filter(function (el) {
                    return el.type == equipmentSelected
                })

                console.log(typeSelected)

                let brandSelected = typeSelected[0].brands.filter(function (el) {
                    return el.brand == textBrandSelected
                })

                console.log(brandSelected)

                selects.models = brandSelected[0].models.reduce((arr, el, i) => {
                    return arr.concat({
                        id: i,
                        text: el
                    })
                }, [])

                $('#selectModel').empty()
                $('#selectModel').select2({
                    placeholder: "Seleccione modelo",
                    width: '100%',
                    data: selects.models
                });

            });

        })

        /*
             CARGAR LOS SELECT2 FIN
         */
        
    }
     

    
</script> 
{{/extend}}