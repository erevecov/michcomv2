<!DOCTYPE html>
<!-- saved from url=(0022)http://localhost:3004/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Cebal</title>
    <link rel="stylesheet" href="./Cebal_files/bootstrap.css">
    <link rel="stylesheet" href="./Cebal_files/jquery-ui.min.css">
    <link rel="stylesheet" href="./Cebal_files/fontawesome-all.min.css">
    <link rel="stylesheet" href="./Cebal_files/datatables.min.css">
    <link rel="stylesheet" href="./Cebal_files/sweetalert2.css">
    <link rel="stylesheet" href="./Cebal_files/datatables.min(1).css">
    <link rel="stylesheet" href="./Cebal_files/select2.min.css">
    <link rel="stylesheet" href="./Cebal_files/toastr.min.css">
    <link rel="stylesheet" href="./Cebal_files/daterangepicker.css">

    <!--Aqui van todos los css-->
    <style>
    body {
         font-size: 0.9rem;
         background-color: #f5f4f4;
         
    }
    .navbar {
        padding: 0.1rem 4rem;
    }
    .bg-dark {
        background-color: rgba(0,0,0,0.8)!important;
    }
    .navbar-nav .nav-item .nav-link {
        font-size: 15px !important;
    }
    .navbar-dark .navbar-nav .nav-link {
    color: #ccc;
}
    .navbar-nav .nav-item .nav-link:hover {
        color:#2980b9 !important;
    }
    .navbar-nav .active a {
        color:#3498db !important;
    }
    #container {
            margin-top:100px;
        }
    </style>
</head>
<body>
    <div class="container-fluid" style="margin-bottom:60px;">
        <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                  <ul class="navbar-nav mr-auto">
                      <!--  <li class="nav-item">
                            <img src="/public/img/logoB.png" width="100px" style="margin-top:3px;margin-left:-10px;margin-right:40px">
                        </li> -->
                        <li class="nav-item">
                            <a class="nav-link active" href="http://localhost:3004/"><i class="fas fa-home"></i> Home</a>
                        </li>
                  
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="http://localhost:3004/#" role="button" aria-haspopup="true" aria-expanded="false"><i class="fas fa-users"></i> Alumnos</a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="http://localhost:3004/joined"><i class="fas fa-user"></i> Ingreso alumnos</a>
                            <a class="dropdown-item" href="http://localhost:3004/enrolled"><i class="fas fa-clipboard-list"></i> Alumnos matriculados</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="http://localhost:3004/#" role="button" aria-haspopup="true" aria-expanded="false"><i class="fas fa-money-check-alt"></i> Finanzas</a>
                            <div class="dropdown-menu">
                              <a class="dropdown-item" href="http://localhost:3004/#">Estado de pagos</a>
                              <a class="dropdown-item" href="http://localhost:3004/#">Boletas</a>
                              <a class="dropdown-item" href="http://localhost:3004/#">Estado cursos</a>
                              <a class="dropdown-item" href="http://localhost:3004/#">Firma de contratos</a>
                            </div>
                    </li>
                    <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="http://localhost:3004/#" role="button" aria-haspopup="true" aria-expanded="false"><i class="fas fa-graduation-cap"></i> Cursos</a>
                            <div class="dropdown-menu">
                              <a class="dropdown-item" href="http://localhost:3004/listStudents">Listado de alumnos</a>
                              <a class="dropdown-item" href="http://localhost:3004/#">Asignación de curso</a>
                              <a class="dropdown-item" href="http://localhost:3004/#">Puntajes</a>
                              <a class="dropdown-item" href="http://localhost:3004/#">Asistencia</a>
                            </div>
                    </li>
                </ul></div>
                <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex">
                        <li class="nav-item dropdown">
                            </li><li class="nav-item">
                                <a class="nav-link active" id="administration" href="http://localhost:3004/administrationPanel"><i class="fas fa-toolbox"></i> Administración</a>
                            </li>
                        
                    
                        <li class="nav-item">
                            </li><li class="nav-item">
                                <a class="nav-link" href="http://localhost:3004/logs"><i class="fas fa-list-ul"></i> Logs</a>
                            </li>
                          
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="http://localhost:3004/#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-user"></i> eduardo reveco
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="http://localhost:3004/logout"><i style="color:#e74c3c;" class="fas fa-sign-out-alt"></i> Cerrar sesión</a>
                        </div>   
                    </li>
                </ul>         
        </nav>
    </div>


    
<style>
    .info-box {
        box-shadow: 0 0 1px rgba(0,0,0,.125), 0 1px 3px rgba(0,0,0,.2);
        border-radius: .25rem;
        padding: .5rem;
        min-height: 80px;
        background: #fff;
        display: flex!important; 
        margin-top:10px;
        font-size: 20px;
    }

    .info-box-icon {
        border-radius: .25rem;
        display: block;
        width: 90px;
        text-align: center;
        font-size: 40px;
        color: #fff!important;
    }


    #firstSearcher {
        width: 100%;
        height:70px;
        font-size:50px;
        text-align:center;
        margin-bottom: 50px;
    }

    #searchbtn {
        min-height:70px !important;
    }

</style>
<div class="container" style="margin-top:100px;">

    <div class="row">
        <div class="col-lg-10 col-md-10 col-xs-10">
            <input id="firstSearcher" type="text" placeholder="Buscar alumno">
        </div>
        <div class="col-lg-2 col-md-2 col-xs-2">
            <button id="searchbtn" class="btn btn-primary btn-lg btn-block"><i class="fas fa-search"></i> Buscar</button>
        </div>
    </div>

    <div class="row" style="margin-top:10px">
        <div class="col-md-12" id="searchresults">
        </div>
    </div>
    

    <div class="row">
        <div class="col-md-6 col-sm-6 col-xs-12">
            <div class="info-box">
                <span class="info-box-icon bg-info elevation-1"><i class="fas fa-align-justify"></i></span>
                <div class="info-box-content">
                <span class="info-box-text"><h5><a class="dropdown-item" href="http://localhost:3004/#">Matrículas</a></h5></span>
                <p style="margin-left: 25px"> 1024</p>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-sm-6 col-xs-12">
            <div class="info-box">
                <span class="info-box-icon bg-info elevation-1" style="background-color: #23ad67 !important;"><i class="fas fa-user"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text"><h5><a class="dropdown-item" href="http://localhost:3004/#"> Alumnos</a></h5></span>
                    <p style="margin-left: 25px"> 845</p>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-sm-6 col-xs-12">
            <div class="info-box">
                <span class="info-box-icon bg-info elevation-1" style="background-color: #ef3f3f !important;"><i class="fas fa-sign-out-alt"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text"><h5><a class="dropdown-item" href="http://localhost:3004/#"> Retirados</a></h5></span>
                    <p style="margin-left: 25px"> 41</p>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-sm-6 col-xs-12">    
            <div class="info-box">      
                <span class="info-box-icon bg-info elevation-1"><i class="fas fa-school"></i></span>
                <div class="info-box-content">
                    <span class="info-box-text"><h5><a class="dropdown-item"> Sede</a></h5></span>
                    <p style="margin-left: 25px;"><b>Curicó</b></p>
                </div>       
            </div>
        </div>
    </div>
    
    <div class="row" style="margin-top:100px;">
        <div class="col-md-12">
            <center> <img src="./Cebal_files/logoN.png" width="350px"></center>
        </div>
    </div>
</div>
<!-- Modal formato-->
<div class="modal fade" id="modalmatriculas" tabindex="-1" role="dialog" aria-labelledby="modal_title">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header" style="background: #ffffff">
                <h4 class="modal-title" id="modal_title"></h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body" id="modal_body"></div>
            <div class="modal-footer" id="modal_footer"></div>
        </div>
    </div>
</div>




<script src="./Cebal_files/jquery-1.12.4.min.js.descarga"></script>
<script src="./Cebal_files/jquery-ui.min.js.descarga"></script>
<script src="./Cebal_files/bootstrap.min.js.descarga"></script>
<script src="./Cebal_files/datatables.min.js.descarga"></script>
<script src="./Cebal_files/sweetalert2.js.descarga"></script>
<script src="./Cebal_files/datatables.min.js(1).descarga"></script>
<script src="./Cebal_files/jquery.rut.min.js.descarga"></script>
<script src="./Cebal_files/select2.min.js.descarga"></script>
<script src="./Cebal_files/toastr.min.js.descarga"></script>
<script src="./Cebal_files/jspdf.min.js.descarga"> </script>
<script src="./Cebal_files/moment.js.descarga"></script>
<script src="./Cebal_files/html2canvas.min.js.descarga"></script>
<script src="./Cebal_files/daterangepicker.js.descarga"></script>

<script>
    moment.locale('es');
    let idleTimer = 0;

    $(document).ready(function() {
        let idleInterval = setInterval(timerIncrement, 60000);

        $(this).mousemove(function(e) {
            idleTimer = 0;
        });

        $(this).keypress(function(e) {
            idleTimer = 0;
        });
        
    });

    const timerIncrement = () => {
        idleTimer++;
        if (idleTimer == 10) { // 10 minutos
            ajax({
                url: 'logout'
            })
            setTimeout(function() {
                location.reload();
            },1000)
        } 
    }

    const ajax = ({type, url, data}) => {
        return new Promise((resolve, reject)=>{
            let options = {
                url
            };
            if(!type){
                options.type = 'GET';
            } else {
                options.type = type;
            }

            if(data) options.data = data;

            $.ajax(options)
            .done((result) => {
                resolve(result);
            })
            .fail(() => {
                reject({error: 'ERROR IN --> '+url+' <--'});
            });
        });
    };

    const createLog = ({form, action, extra, type}) => {
        //console.log(desc,form,String(extra))
        return new Promise(resolve=>{
            ajax({ 
                url:'/api/log',
                type: 'POST', 
                data: {action: action, form: form, extra: String(extra), type: type} 
            }).then(data=>{
                resolve(data);
            })
        })
        
    }

    const screenLog = ({id, form, action, extra, type}) => {
        html2canvas(document.querySelector("#"+id)).then(function(canvas) {
            createLog({
                form: form,
                action: action,
                extra: extra,
                type: type
            }).then(data=>{
                let canvasToImg = canvas.toDataURL('image/jpeg');
                let formatId1 = data.id.replace(/:/g, 'Q');
                
                ajax({
                    url: "/api/tools/uploadImgLog", // Url to which the request is send
                    type: "POST",             // Type of request to be send, called as method
                    data: {id: formatId1, img:canvasToImg}
                }).then(res=>{
                    console.log(res)  
                })
            });
        });
    }

    const isEmail = (email) => {
		let regexEmail = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
		return regexEmail.test(email);
	}

</script>



<script>

$('#searchbtn').on('click', function() {
    let searchval = $('#firstSearcher').val();
    let searchtype  = '';

    if (isEmail(searchval)) {
        searchtype  = 'email';
    } else if ($.validateRut(searchval)) {
        searchtype  = 'rut';
        $('#firstSearcher').val($.formatRut(searchval));
    } else if (searchval.includes("-") || searchval.includes(".")) {
        searchtype  = 'rut';
    } else if (searchval.length == 0){
        toastr.warning('El campo de busqueda está vacío');
    } else {
        searchtype = 'name'
    }
    
    if(searchtype) {
        console.log(searchtype)
        console.log(searchval)

        ajax({
            url: '/api/tools/firstsearch',
            type: 'POST',
            data: {type: searchtype, val: searchval}
        }).then(res=> {
            console.log(res)
            $('#searchresults').html(`
                <div class="jumbotron table-responsive">
                    <a href="#" id="closeresults" style="float:right;"><i class="fas fa-times"></i></a>
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th scope="col">Rut</th>
                                <th scope="col">Nombre</th>
                                <th scope="col">Email</th>
                                <th scope="col">Estado</th>
                                <th scope="col">Historial</th>
                            </tr>
                        </thead>
                        <tbody id="tablebody">
                        </tbody>
                    </table>
                </div>
            `)

            let tableBodyHTML = res.ok.reduce((html, el, i) => {
                console.log(el)
                return html += `
                    <tr>
                        <th scope="row">${el._id}</th>
                        <td>${el.name} ${el.lastname1}</td>
                        <td>${el.email}</td>
                        <td><button class="btn btn-primary statusbtn">${el.status}</button></td>
                        <td><button class="btn btn-dark"><i class="far fa-file-alt"></i></button></td>
                    </tr>
                `   
            }, '');

            $('#tablebody').html(tableBodyHTML)
        })
    } 
})

$('#verListaMatriculas').on('click', function () {
    ModalMatriculas();
})

$('#searchresults').on('click', '#closeresults', function() {
    $('#searchresults').empty();
    $('#firstsearcher').val('');
});

function ModalMatriculas() { 
    $('#modalmatriculas').modal();
    $('#modal_title').text('Listado de matriculas');
    $('#modal_body').html(`

    `)
}

</script>

    

</body></html>